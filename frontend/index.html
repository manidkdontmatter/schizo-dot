<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Schizo Dot - Collective Consciousness of 4chan</title>
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <style>
    body {
      background: #000000; /* Deep space black */
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
      font-family: 'Arial', sans-serif;
      position: relative;
    }

    /* Nebula clouds layer */
    .nebula {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background:
        radial-gradient(ellipse at 20% 30%, rgba(128, 0, 128, 0.3), transparent 50%),
        radial-gradient(ellipse at 50% 70%, rgba(0, 0, 255, 0.2), transparent 50%),
        radial-gradient(ellipse at 80% 40%, rgba(255, 20, 147, 0.25), transparent 50%),
        radial-gradient(ellipse at 30% 80%, rgba(75, 0, 130, 0.3), transparent 50%),
        radial-gradient(ellipse at 70% 20%, rgba(0, 191, 255, 0.2), transparent 50%);
      filter: blur(100px);
      opacity: 0.7;
      z-index: -10;
      animation: nebula-drift 60s linear infinite alternate, nebula-glow 20s ease-in-out infinite alternate;
    }

    @keyframes nebula-drift {
      0% { transform: translate(0, 0); }
      100% { transform: translate(50px, 50px); }
    }

    @keyframes nebula-glow {
      0% { opacity: 0.6; filter: blur(100px) hue-rotate(0deg); }
      100% { opacity: 0.8; filter: blur(100px) hue-rotate(30deg); }
    }

    /* Stars background layer */
    .stars {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      pointer-events: none;
    }

    .star {
      position: absolute;
      background: #ffffff;
      border-radius: 50%;
      opacity: 0.8;
      animation: pulsate 5s infinite ease-in-out alternate, rotate-star 30s linear infinite, color-shift 10s infinite alternate;
    }

    @keyframes pulsate {
      0% { transform: scale(1); }
      100% { transform: scale(1.5); }
    }

    @keyframes rotate-star {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @keyframes color-shift {
      0% { background: #ffffff; box-shadow: 0 0 10px #ffffff; }
      25% { background: #a29bff; box-shadow: 0 0 10px #a29bff; }
      50% { background: #8a2be2; box-shadow: 0 0 10px #8a2be2; }
      75% { background: #ff69b4; box-shadow: 0 0 10px #ff69b4; }
      100% { background: #ffffff; box-shadow: 0 0 10px #ffffff; }
    }

    /* Scatter stars randomly */
    .star:nth-child(1) { top: 10%; left: 15%; width: 2px; height: 2px; animation-delay: 0s; }
    .star:nth-child(2) { top: 20%; left: 25%; width: 3px; height: 3px; animation-delay: 1s; }
    .star:nth-child(3) { top: 30%; left: 35%; width: 1px; height: 1px; animation-delay: 2s; }
    .star:nth-child(4) { top: 40%; left: 45%; width: 4px; height: 4px; animation-delay: 3s; }
    .star:nth-child(5) { top: 50%; left: 55%; width: 2px; height: 2px; animation-delay: 4s; }
    .star:nth-child(6) { top: 60%; left: 65%; width: 3px; height: 3px; animation-delay: 5s; }
    .star:nth-child(7) { top: 70%; left: 75%; width: 1px; height: 1px; animation-delay: 6s; }
    .star:nth-child(8) { top: 80%; left: 85%; width: 4px; height: 4px; animation-delay: 7s; }
    .star:nth-child(9) { top: 15%; left: 5%; width: 2px; height: 2px; animation-delay: 8s; }
    .star:nth-child(10) { top: 25%; left: 95%; width: 3px; height: 3px; animation-delay: 9s; }
    .star:nth-child(11) { top: 35%; left: 10%; width: 1px; height: 1px; animation-delay: 10s; }
    .star:nth-child(12) { top: 45%; left: 20%; width: 4px; height: 4px; animation-delay: 11s; }
    .star:nth-child(13) { top: 55%; left: 30%; width: 2px; height: 2px; animation-delay: 12s; }
    .star:nth-child(14) { top: 65%; left: 40%; width: 3px; height: 3px; animation-delay: 13s; }
    .star:nth-child(15) { top: 75%; left: 50%; width: 1px; height: 1px; animation-delay: 14s; }
    .star:nth-child(16) { top: 85%; left: 60%; width: 4px; height: 4px; animation-delay: 15s; }
    .star:nth-child(17) { top: 5%; left: 70%; width: 2px; height: 2px; animation-delay: 16s; }
    .star:nth-child(18) { top: 95%; left: 80%; width: 3px; height: 3px; animation-delay: 17s; }
    .star:nth-child(19) { top: 25%; left: 90%; width: 1px; height: 1px; animation-delay: 18s; }
    .star:nth-child(20) { top: 35%; left: 0%; width: 4px; height: 4px; animation-delay: 19s; }

    .dot {
      width: 250px;
      height: 250px;
      border-radius: 50%;
      position: relative;
      /* Enhanced 3D with radial gradient base for sphere curvature */
      background: radial-gradient(circle at 40% 40%, rgba(255,255,255,1), rgba(0,0,0,1) 70%);
      box-shadow:
        inset 30px 30px 80px rgba(255, 255, 255, 0.5), /* Stronger top-left highlight */
        inset -30px -30px 80px rgba(0, 0, 0, 0.6), /* Deeper bottom-right shadow */
        0 0 150px rgba(255, 255, 255, 0.6),
        0 0 250px rgba(255, 255, 255, 0.4);
      animation: pulse 4s infinite ease-in-out;
      z-index: 5;
      overflow: visible;
    }

    .dot::before {
      content: '';
      position: absolute;
      top: -70px;
      left: -70px;
      right: -70px;
      bottom: -70px;
      border-radius: 50%;
      background: radial-gradient(circle, var(--aura-color, rgba(138, 43, 226, 0.5)), transparent 70%);
      filter: blur(60px);
      opacity: 0.8;
      z-index: -1;
      animation: aura 5s infinite ease-in-out;
    }

    .dot::after {
      content: '';
      position: absolute;
      top: -50px;
      left: -50px;
      right: -50px;
      bottom: -50px;
      border-radius: 50%;
      background: conic-gradient(from 0deg, transparent, rgba(255,255,255,0.5), var(--aura-color, rgba(138,43,226,0.5)), transparent);
      animation: rotate 8s linear infinite;
      z-index: -1;
      filter: blur(15px);
    }

    /* Energy particles rising from dot */
    .energy-particles {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1; /* Behind the sphere surface but part of dot */
      pointer-events: none;
    }

    .energy-particle {
      position: absolute;
      background: var(--particle-bg, rgba(255, 255, 255, 0.9));
      border-radius: 50%;
      box-shadow: 0 0 10px var(--particle-shadow, rgba(138, 43, 226, 0.8));
      animation: rise 6s linear infinite;
    }

    @keyframes rise {
      0% { transform: translate(0, 0) scale(1); opacity: 1; }
      100% { transform: translate(0, -300px) scale(0.5); opacity: 0; }
    }

    .energy-particle:nth-child(1) { width: 5px; height: 5px; top: 80%; left: 40%; animation-duration: 4s; animation-delay: 0s; }
    .energy-particle:nth-child(2) { width: 3px; height: 3px; top: 90%; left: 60%; animation-duration: 5s; animation-delay: 1s; }
    .energy-particle:nth-child(3) { width: 4px; height: 4px; top: 85%; left: 50%; animation-duration: 6s; animation-delay: 2s; }
    .energy-particle:nth-child(4) { width: 6px; height: 6px; top: 95%; left: 70%; animation-duration: 4.5s; animation-delay: 3s; }
    .energy-particle:nth-child(5) { width: 2px; height: 2px; top: 82%; left: 30%; animation-duration: 5.5s; animation-delay: 0.5s; }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.15); }
    }

    @keyframes aura {
      0%, 100% { opacity: 0.6; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.3); }
    }

    @keyframes rotate {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .title {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      color: #fff;
      font-size: 32px;
      font-weight: bold;
      text-shadow: 0 0 25px rgba(255, 255, 255, 0.9), 0 0 50px rgba(138, 43, 226, 0.6);
      z-index: 10;
      animation: glow 3s ease-in-out infinite alternate;
    }

    @keyframes glow {
      0% { text-shadow: 0 0 25px rgba(255, 255, 255, 0.9), 0 0 50px rgba(138, 43, 226, 0.6); }
      100% { text-shadow: 0 0 40px rgba(255, 255, 255, 1), 0 0 70px rgba(138, 43, 226, 0.8); }
    }

    .description {
      position: absolute;
      top: 60px;
      left: 50%;
      transform: translateX(-50%);
      color: #fff;
      font-size: 18px;
      text-align: center;
      text-shadow: 0 0 15px rgba(255, 255, 255, 0.6), 0 0 30px rgba(138, 43, 226, 0.4);
      z-index: 10;
    }

    .description a {
      color: yellow;
    }

    a {
      color: yellow;
    }

    .sentiment {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      color: #fff;
      font-size: 20px;
      text-align: center;
      text-shadow: 0 0 15px rgba(255, 255, 255, 0.6), 0 0 30px rgba(138, 43, 226, 0.4);
      z-index: 10;
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
    }

    .modal-content {
      background: radial-gradient(circle at center, rgba(0, 0, 0, 0.9), rgba(20, 20, 50, 0.9));
      margin: 2% auto;
      padding: 20px;
      border: 2px solid rgba(138, 43, 226, 0.5);
      border-radius: 10px;
      width: 80%;
      max-width: 600px;
      height: 96%;
      color: #fff;
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
      box-shadow: 0 0 50px rgba(138, 43, 226, 0.8), inset 0 0 50px rgba(0, 0, 0, 0.5);
      overflow-y: auto;
    }

    .close {
      color: #fff;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
    }

    .close:hover {
      color: yellow;
    }

    .modal-content p {
      font-size: 18px;
      line-height: 1.6;
    }
  </style>
</head>
<body>
  <div class="nebula"></div>
  <div class="stars">
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
  </div>
  <div class="title">Schizo Dot</div>
  <div class="description">Strongly interpret the dot.<br>The dot measures 4chan's collective consciousness.<br><a href="#" onclick="showModal()">Details</a> | <a href="https://github.com/manidkdontmatter/schizo-dot" target="_blank">Github</a></div>
  <div class="dot" id="dot">
    <div class="energy-particles">
      <div class="energy-particle"></div>
      <div class="energy-particle"></div>
      <div class="energy-particle"></div>
      <div class="energy-particle"></div>
      <div class="energy-particle"></div>
    </div>
  </div>
  <div class="sentiment" id="sentiment">Loading...</div>

  <div id="modal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <p>The dot measures the collective consciousness of 4chan's /x/ and /pol/ boards. A neural network reads every thread and every reply, selecting only the finest schizo posts and posts that are future predictive and filtering out low quality posts and assigns a "doom" or "hope" score to each post. This is then combined into a collective score. This score is then made even more future predictive by the dot not showing you the score of the current time, but an extrapolated score of the past few scores, aka the color the dot should be in the future.</p>
    </div>
  </div>

  <div id="reasoning-modal" class="modal">
    <div class="modal-content" style="width: 90%; max-width: 1000px; height: 98%; margin-top: 10px; overflow-y: auto;">
      <span class="close" onclick="closeReasoningModal()">&times;</span>
      <div id="reasoning-content"></div>
    </div>
  </div>

  <script>
    function interpolateColor(score) {
      // Normalize score: -0.5 becomes -1, 0 becomes 0, 0.5 becomes 1
      const norm = Math.max(-1, Math.min(1, score * 2));
      // Now interpolate from red (-1) to yellow (0) to green (1)
      if (norm <= -1) return [255, 0, 0]; // Red
      if (norm >= 1) return [0, 255, 0]; // Green
      if (norm <= 0) {
        // From red to yellow
        const t = (norm + 1) / 1; // 0 to 1
        const r = 255;
        const g = t * 255;
        const b = 0;
        return [r, g, b];
      } else {
        // From yellow to green
        const t = norm / 1; // 0 to 1
        const r = 255 - t * 255;
        const g = 255;
        const b = 0;
        return [r, g, b];
      }
    }

    function clamp(value) {
      return Math.max(0, Math.min(255, value));
    }

    async function updateDot() {
      try {
        const response = await fetch('/sentiment');
        const data = await response.json();

        const avgSentiment = data.average || 0;

        const dot = document.getElementById('dot');
        const sentimentEl = document.getElementById('sentiment');

        // Get base color
        let [r, g, b] = interpolateColor(avgSentiment);

        // Calculate lighter and darker for metallic gradient
        const lighterR = clamp(r * 1.3);
        const lighterG = clamp(g * 1.3);
        const lighterB = clamp(b * 1.3);
        const darkerR = clamp(r * 0.7);
        const darkerG = clamp(g * 0.7);
        const darkerB = clamp(b * 0.7);

        const color = `rgb(${Math.round(r)}, ${Math.round(g)}, ${Math.round(b)})`;
        const lighterColor = `rgb(${Math.round(lighterR)}, ${Math.round(lighterG)}, ${Math.round(lighterB)})`;
        const darkerColor = `rgb(${Math.round(darkerR)}, ${Math.round(darkerG)}, ${Math.round(darkerB)})`;

        // Set CSS variables for auras and particles
        dot.style.setProperty('--aura-color', `rgba(${Math.round(r)}, ${Math.round(g)}, ${Math.round(b)}, 0.5)`);
        dot.style.setProperty('--particle-bg', `rgba(${Math.round(r)}, ${Math.round(g)}, ${Math.round(b)}, 0.9)`);
        dot.style.setProperty('--particle-shadow', `rgba(${Math.round(r)}, ${Math.round(g)}, ${Math.round(b)}, 0.8)`);

        // Set metallic background with 3D layering (blend with base radial)
        dot.style.background = `radial-gradient(circle at 40% 40%, ${lighterColor}, ${color} 50%, ${darkerColor} 80%)`;

        // Update box-shadow to match color
        dot.style.boxShadow = `inset 30px 30px 80px rgba(255, 255, 255, 0.5), inset -30px -30px 80px rgba(0, 0, 0, 0.6), 0 0 150px rgba(${Math.round(r)}, ${Math.round(g)}, ${Math.round(b)}, 0.6), 0 0 250px rgba(${Math.round(r)}, ${Math.round(g)}, ${Math.round(b)}, 0.4)`;

        // Size based on absolute sentiment
        const size = 150 + Math.abs(avgSentiment) * 50;
        dot.style.width = `${size}px`;
        dot.style.height = `${size}px`;

        // Update sentiment text
        let label;
        if (avgSentiment < -0.5) label = 'Extreme Doom';
        else if (avgSentiment < -0.35) label = 'Doom';
        else if (avgSentiment < -0.2) label = 'Mild Doom';
        else if (avgSentiment <= 0.2) label = 'Neutral';
        else if (avgSentiment <= 0.35) label = 'Mild Hope';
        else if (avgSentiment <= 0.5) label = 'Hope';
        else label = 'Extreme Hope';
        sentimentEl.innerHTML = `Sentiment: ${avgSentiment.toFixed(2)} (${label})<br><a href="#" onclick="showReasoningModal()">View Reasoning</a>`;

      } catch (error) {
        console.error('Error loading sentiment:', error);
        document.getElementById('sentiment').textContent = 'Error loading data';
      }
    }

    updateDot();
    function showModal() {
      document.getElementById('modal').style.display = 'block';
    }

    function closeModal() {
      document.getElementById('modal').style.display = 'none';
    }

    function showReasoningModal() {
      document.getElementById('reasoning-modal').style.display = 'block';
      fetchReasoning();
    }

    function closeReasoningModal() {
      document.getElementById('reasoning-modal').style.display = 'none';
    }

    async function fetchReasoning() {
      try {
        const response = await fetch('/reasoning');
        const text = await response.text();
        const content = document.getElementById('reasoning-content');
        content.innerHTML = text.split('\n\n').map(p => `<p style="text-align: center;">${p}</p>`).join('');
      } catch (error) {
        document.getElementById('reasoning-content').innerHTML = '<p style="text-align: center;">Error loading reasoning data</p>';
      }
    }

    // Close modal when clicking outside
    window.onclick = function(event) {
      if (event.target == document.getElementById('modal')) {
        closeModal();
      }
      if (event.target == document.getElementById('reasoning-modal')) {
        closeReasoningModal();
      }
    }
    setInterval(updateDot, 15 * 60 * 1000);
  </script>
</body>
</html>